<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.cemenghui.news.mapper.NewsMapper">

    <!-- 1. 多条件搜索新闻 -->
    <select id="findByCondition" resultType="com.wakeup.pojo.News">
        SELECT * FROM news
        WHERE is_deleted = 0
        <if test="request.keyword != null and request.keyword != ''">
            AND (
            title LIKE CONCAT('%', #{request.keyword}, '%')OR
            author LIKE CONCAT('%', #{request.keyword}, '%')OR
            summary LIKE CONCAT('%', #{request.keyword}, '%')
            )
        </if>
        <if test="request.status != null">
            AND status = #{request.status}
        </if>
        <if test="request.startDate != null">
            AND create_time &gt;= #{request.startDate}
        </if>
        <if test="request.endDate != null">
            AND create_time &lt;= #{request.endDate}
        </if>
        ORDER BY create_time DESC
    </select>

    <!-- 2. 根据用户 ID 查询新闻 -->
    <select id="findByUserId" resultType="com.wakeup.pojo.News">
        SELECT * FROM news
        WHERE user_id = #{userId}
          AND is_deleted = 0
        ORDER BY create_time DESC
    </select>

    <!-- 3. 查询待审核新闻 -->
    <select id="findPendingNews" resultType="com.wakeup.pojo.News">
        SELECT * FROM news
        WHERE status = 0
          AND is_deleted = 0
        ORDER BY create_time ASC
    </select>

    <!-- 4. 基础统计数据（每日新闻数量） -->
    <select id="getBasicStatistics" resultType="map">
        SELECT
            DATE_FORMAT(create_time, '%Y-%m-%d') AS date,
            COUNT(*) AS count
        FROM news
        WHERE is_deleted = 0
        GROUP BY DATE_FORMAT(create_time, '%Y-%m-%d')
        ORDER BY date ASC
    </select>

</mapper>
