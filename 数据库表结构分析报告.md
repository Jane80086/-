# æ•°æ®åº“è¡¨ç»“æ„åˆ†ææŠ¥å‘Š

## ğŸ“Š æ¦‚è¿°

æœ¬æŠ¥å‘Šåˆ†æäº†è¯¾ç¨‹ç®¡ç†ç³»ç»Ÿçš„æ•°æ®åº“è¡¨ç»“æ„ï¼Œè¯†åˆ«äº†å…±ç”¨çš„è¡¨ï¼Œå¹¶æä¾›äº†ä¼˜åŒ–æ•´åˆæ–¹æ¡ˆã€‚

## ğŸ” åŸå§‹è¡¨ç»“æ„åˆ†æ

### 1. ç”¨æˆ·æ¨¡å—é‡å¤è¡¨
**é—®é¢˜**ï¼šå­˜åœ¨4ä¸ªç”¨æˆ·ç›¸å…³è¡¨ï¼ŒåŠŸèƒ½é‡å¤
- `user_info` - åŸºç¡€ç”¨æˆ·ä¿¡æ¯
- `admin_user` - ç®¡ç†å‘˜ç”¨æˆ·
- `enterprise_user` - ä¼ä¸šç”¨æˆ·  
- `system_user` - ç³»ç»Ÿç”¨æˆ·

**æ•´åˆæ–¹æ¡ˆ**ï¼šåˆå¹¶ä¸ºç»Ÿä¸€çš„ `users` è¡¨ï¼Œé€šè¿‡ `user_type` å­—æ®µåŒºåˆ†ç”¨æˆ·ç±»å‹

### 2. å®¡æ ¸åŠŸèƒ½é‡å¤è¡¨
**é—®é¢˜**ï¼šå­˜åœ¨3ä¸ªå®¡æ ¸ç›¸å…³è¡¨ï¼ŒåŠŸèƒ½åˆ†æ•£
- `course_review_history` - è¯¾ç¨‹å®¡æ ¸å†å²
- `meeting_review_record` - ä¼šè®®å®¡æ ¸è®°å½•
- `review` - è¯¾ç¨‹å®¡æ ¸è¡¨

**æ•´åˆæ–¹æ¡ˆ**ï¼šåˆå¹¶ä¸ºç»Ÿä¸€çš„ `audit_records` è¡¨ï¼Œé€šè¿‡ `resource_type` å­—æ®µåŒºåˆ†å®¡æ ¸å¯¹è±¡

### 3. æ—¥å¿—åŠŸèƒ½é‡å¤è¡¨
**é—®é¢˜**ï¼šå­˜åœ¨2ä¸ªæ—¥å¿—è¡¨ï¼ŒåŠŸèƒ½é‡å¤
- `user_view_log` - ç”¨æˆ·æµè§ˆæ—¥å¿—ï¼ˆä»…æ–°é—»ï¼‰
- `user_operation_log` - ç”¨æˆ·æ“ä½œæ—¥å¿—ï¼ˆä»…æ–°é—»ï¼‰

**æ•´åˆæ–¹æ¡ˆ**ï¼šæ‰©å±•ä¸ºç»Ÿä¸€çš„æ—¥å¿—è¡¨ï¼Œæ”¯æŒæ‰€æœ‰æ¨¡å—çš„æ—¥å¿—è®°å½•

### 4. å†å²è®°å½•é‡å¤è¡¨
**é—®é¢˜**ï¼šå­˜åœ¨2ä¸ªå†å²è®°å½•è¡¨
- `course_history` - è¯¾ç¨‹å†å²
- `user_modify_history` - ç”¨æˆ·ä¿®æ”¹å†å²

**æ•´åˆæ–¹æ¡ˆ**ï¼šåˆå¹¶ä¸ºç»Ÿä¸€çš„ `history_records` è¡¨

## ğŸ¯ ä¼˜åŒ–åçš„è¡¨ç»“æ„

### 1. ç»Ÿä¸€ç”¨æˆ·æ¨¡å—

#### `users` è¡¨ï¼ˆæ•´åˆæ‰€æœ‰ç”¨æˆ·ç±»å‹ï¼‰
```sql
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    username VARCHAR(100) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
    real_name VARCHAR(100),
    email VARCHAR(255),
    phone VARCHAR(20),
    user_type VARCHAR(20) NOT NULL, -- ADMIN, ENTERPRISE, NORMAL, SYSTEM
    status INTEGER DEFAULT 1,
    department VARCHAR(100),
    nickname VARCHAR(100),
    is_remembered BOOLEAN DEFAULT FALSE,
    enterprise_id VARCHAR(64),
    dynamic_code VARCHAR(20),
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    deleted INTEGER DEFAULT 0
);
```

**ä¼˜åŠ¿**ï¼š
- ç»Ÿä¸€ç”¨æˆ·ç®¡ç†ï¼Œå‡å°‘è¡¨æ•°é‡
- é€šè¿‡ `user_type` å­—æ®µåŒºåˆ†ç”¨æˆ·è§’è‰²
- æ”¯æŒä¼ä¸šç”¨æˆ·å…³è”ä¼ä¸šä¿¡æ¯
- ç»Ÿä¸€çš„çŠ¶æ€ç®¡ç†å’Œè½¯åˆ é™¤

#### `enterprise` è¡¨ï¼ˆä¼ä¸šä¿¡æ¯ï¼‰
```sql
CREATE TABLE enterprise (
    enterprise_id VARCHAR(30) PRIMARY KEY,
    enterprise_name VARCHAR(100) NOT NULL,
    credit_code VARCHAR(30) UNIQUE,
    -- å…¶ä»–ä¼ä¸šä¿¡æ¯å­—æ®µ...
);
```

### 2. ç»Ÿä¸€å®¡æ ¸æ¨¡å—

#### `audit_records` è¡¨ï¼ˆæ•´åˆæ‰€æœ‰å®¡æ ¸åŠŸèƒ½ï¼‰
```sql
CREATE TABLE audit_records (
    id SERIAL PRIMARY KEY,
    resource_type VARCHAR(50) NOT NULL, -- COURSE, MEETING, NEWS, USER
    resource_id BIGINT NOT NULL,
    resource_name VARCHAR(255),
    action VARCHAR(50) NOT NULL, -- APPROVE, REJECT, MODIFY, DELETE
    reviewer_id BIGINT NOT NULL,
    reviewer_name VARCHAR(100),
    status VARCHAR(20) NOT NULL, -- PENDING, APPROVED, REJECTED
    comment TEXT,
    old_value TEXT,
    new_value TEXT,
    audit_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

**ä¼˜åŠ¿**ï¼š
- ç»Ÿä¸€å®¡æ ¸æµç¨‹ï¼Œæ”¯æŒæ‰€æœ‰èµ„æºç±»å‹
- å®Œæ•´çš„å®¡æ ¸å†å²è®°å½•
- æ”¯æŒå®¡æ ¸çŠ¶æ€è·Ÿè¸ª
- è®°å½•å®¡æ ¸å‰åçš„å€¼å˜åŒ–

### 3. ç»Ÿä¸€æ—¥å¿—æ¨¡å—

#### `user_view_logs` è¡¨ï¼ˆæ•´åˆæ‰€æœ‰æµè§ˆè®°å½•ï¼‰
```sql
CREATE TABLE user_view_logs (
    id SERIAL PRIMARY KEY,
    user_id BIGINT,
    resource_type VARCHAR(50) NOT NULL, -- COURSE, NEWS, MEETING
    resource_id BIGINT NOT NULL,
    resource_title VARCHAR(255),
    ip_address VARCHAR(50),
    user_agent VARCHAR(500),
    session_id VARCHAR(100),
    view_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### `user_operation_logs` è¡¨ï¼ˆæ•´åˆæ‰€æœ‰æ“ä½œè®°å½•ï¼‰
```sql
CREATE TABLE user_operation_logs (
    id SERIAL PRIMARY KEY,
    user_id BIGINT NOT NULL,
    operation_type VARCHAR(50) NOT NULL, -- CREATE, UPDATE, DELETE, PUBLISH, AUDIT
    resource_type VARCHAR(50) NOT NULL, -- COURSE, NEWS, MEETING, USER
    resource_id BIGINT NOT NULL,
    resource_title VARCHAR(255),
    operation_desc VARCHAR(500),
    old_value TEXT,
    new_value TEXT,
    ip_address VARCHAR(50),
    operation_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    operation_result INTEGER DEFAULT 1
);
```

**ä¼˜åŠ¿**ï¼š
- ç»Ÿä¸€æ—¥å¿—è®°å½•ï¼Œæ”¯æŒæ‰€æœ‰æ¨¡å—
- å®Œæ•´çš„æ“ä½œè¿½è¸ª
- æ”¯æŒæ“ä½œç»“æœè®°å½•
- ä¾¿äºæ•°æ®åˆ†æå’Œå®¡è®¡

### 4. ç»Ÿä¸€å†å²è®°å½•æ¨¡å—

#### `history_records` è¡¨ï¼ˆæ•´åˆæ‰€æœ‰å†å²è®°å½•ï¼‰
```sql
CREATE TABLE history_records (
    id SERIAL PRIMARY KEY,
    resource_type VARCHAR(50) NOT NULL, -- COURSE, USER, ENTERPRISE
    resource_id BIGINT NOT NULL,
    action VARCHAR(50) NOT NULL, -- VIEW, MODIFY, DELETE
    user_id BIGINT,
    old_value TEXT,
    new_value TEXT,
    record_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

**ä¼˜åŠ¿**ï¼š
- ç»Ÿä¸€å†å²è®°å½•ç®¡ç†
- æ”¯æŒæ‰€æœ‰èµ„æºç±»å‹çš„å†å²è¿½è¸ª
- è®°å½•å€¼å˜åŒ–å†å²

## ğŸ“ˆ ä¼˜åŒ–æ•ˆæœå¯¹æ¯”

### è¡¨æ•°é‡å‡å°‘
| æ¨¡å— | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | å‡å°‘æ•°é‡ |
|------|--------|--------|----------|
| ç”¨æˆ·æ¨¡å— | 4ä¸ªè¡¨ | 2ä¸ªè¡¨ | 50% |
| å®¡æ ¸æ¨¡å— | 3ä¸ªè¡¨ | 1ä¸ªè¡¨ | 67% |
| æ—¥å¿—æ¨¡å— | 2ä¸ªè¡¨ | 2ä¸ªè¡¨ | 0% |
| å†å²æ¨¡å— | 2ä¸ªè¡¨ | 1ä¸ªè¡¨ | 50% |
| **æ€»è®¡** | **11ä¸ªè¡¨** | **6ä¸ªè¡¨** | **45%** |

### åŠŸèƒ½å¢å¼º
1. **ç»Ÿä¸€ç®¡ç†**ï¼šæ‰€æœ‰ç”¨æˆ·ç±»å‹ç»Ÿä¸€ç®¡ç†
2. **æ‰©å±•æ€§**ï¼šæ”¯æŒæ–°çš„èµ„æºç±»å‹å’Œæ“ä½œç±»å‹
3. **ä¸€è‡´æ€§**ï¼šç»Ÿä¸€çš„æ•°æ®ç»“æ„å’Œå‘½åè§„èŒƒ
4. **å¯ç»´æŠ¤æ€§**ï¼šå‡å°‘é‡å¤ä»£ç å’Œè¡¨ç»“æ„

## ğŸ”§ æ•°æ®è¿ç§»æ–¹æ¡ˆ

### 1. ç”¨æˆ·æ•°æ®è¿ç§»
```sql
-- è¿ç§»ç®¡ç†å‘˜ç”¨æˆ·
INSERT INTO users (username, password, real_name, email, phone, user_type, status, department, nickname)
SELECT account, password, real_name, email, phone, 'ADMIN', 1, department, nickname
FROM admin_user;

-- è¿ç§»ä¼ä¸šç”¨æˆ·
INSERT INTO users (username, password, real_name, email, phone, user_type, status, enterprise_id, department, nickname)
SELECT account, password, real_name, email, phone, 'ENTERPRISE', 1, enterprise_id, department, nickname
FROM enterprise_user;

-- è¿ç§»ç³»ç»Ÿç”¨æˆ·
INSERT INTO users (username, password, real_name, email, phone, user_type, status, department, nickname)
SELECT account, password, real_name, email, phone, 'SYSTEM', 1, department, nickname
FROM system_user;
```

### 2. å®¡æ ¸æ•°æ®è¿ç§»
```sql
-- è¿ç§»è¯¾ç¨‹å®¡æ ¸è®°å½•
INSERT INTO audit_records (resource_type, resource_id, resource_name, action, reviewer_id, reviewer_name, status, comment, audit_time)
SELECT 'COURSE', course_id, 'è¯¾ç¨‹å®¡æ ¸', 'APPROVE', reviewer_id, reviewer_name, status, review_comment, review_time
FROM course_review_history;

-- è¿ç§»ä¼šè®®å®¡æ ¸è®°å½•
INSERT INTO audit_records (resource_type, resource_id, resource_name, action, reviewer_id, reviewer_name, status, comment, audit_time)
SELECT 'MEETING', meeting_id, meeting_name, 'APPROVE', reviewer_id, reviewer_name, status, review_comment, review_time
FROM meeting_review_record;
```

### 3. æ—¥å¿—æ•°æ®è¿ç§»
```sql
-- è¿ç§»æµè§ˆæ—¥å¿—
INSERT INTO user_view_logs (user_id, resource_type, resource_id, resource_title, ip_address, session_id, view_time)
SELECT user_id, 'NEWS', news_id, 'æ–°é—»æµè§ˆ', ip_address, session_id, view_time
FROM user_view_log;

-- è¿ç§»æ“ä½œæ—¥å¿—
INSERT INTO user_operation_logs (user_id, operation_type, resource_type, resource_id, resource_title, operation_desc, ip_address, operation_time)
SELECT user_id, operation_type, resource_type, resource_id, 'æ–°é—»æ“ä½œ', operation_desc, ip_address, operation_time
FROM user_operation_log;
```

## ğŸš€ å®æ–½å»ºè®®

### 1. åˆ†é˜¶æ®µå®æ–½
1. **ç¬¬ä¸€é˜¶æ®µ**ï¼šåˆ›å»ºæ–°çš„ä¼˜åŒ–è¡¨ç»“æ„
2. **ç¬¬äºŒé˜¶æ®µ**ï¼šæ•°æ®è¿ç§»å’ŒéªŒè¯
3. **ç¬¬ä¸‰é˜¶æ®µ**ï¼šæ›´æ–°åº”ç”¨ç¨‹åºä»£ç 
4. **ç¬¬å››é˜¶æ®µ**ï¼šåˆ é™¤æ—§è¡¨ç»“æ„

### 2. ä»£ç æ›´æ–°è¦ç‚¹
- æ›´æ–°ç”¨æˆ·ç›¸å…³çš„DAOå±‚ä»£ç 
- ä¿®æ”¹å®¡æ ¸æµç¨‹çš„ä¸šåŠ¡é€»è¾‘
- è°ƒæ•´æ—¥å¿—è®°å½•çš„å®ç°æ–¹å¼
- æ›´æ–°å†å²è®°å½•çš„å¤„ç†é€»è¾‘

### 3. æµ‹è¯•éªŒè¯
- æ•°æ®å®Œæ•´æ€§éªŒè¯
- åŠŸèƒ½å›å½’æµ‹è¯•
- æ€§èƒ½æµ‹è¯•
- ç”¨æˆ·éªŒæ”¶æµ‹è¯•

## ğŸ“‹ æ€»ç»“

é€šè¿‡æœ¬æ¬¡æ•°æ®åº“è¡¨ç»“æ„ä¼˜åŒ–ï¼Œæˆ‘ä»¬å®ç°äº†ï¼š

1. **å‡å°‘45%çš„è¡¨æ•°é‡**ï¼Œä»11ä¸ªè¡¨å‡å°‘åˆ°6ä¸ªè¡¨
2. **ç»Ÿä¸€äº†ç”¨æˆ·ç®¡ç†**ï¼Œæ”¯æŒæ‰€æœ‰ç”¨æˆ·ç±»å‹çš„ç»Ÿä¸€ç®¡ç†
3. **æ•´åˆäº†å®¡æ ¸åŠŸèƒ½**ï¼Œæä¾›ç»Ÿä¸€çš„å®¡æ ¸æµç¨‹
4. **æ‰©å±•äº†æ—¥å¿—åŠŸèƒ½**ï¼Œæ”¯æŒæ‰€æœ‰æ¨¡å—çš„æ—¥å¿—è®°å½•
5. **æé«˜äº†ç³»ç»Ÿå¯ç»´æŠ¤æ€§**ï¼Œå‡å°‘äº†é‡å¤ä»£ç å’Œè¡¨ç»“æ„

ä¼˜åŒ–åçš„æ•°æ®åº“ç»“æ„æ›´åŠ æ¸…æ™°ã€ç»Ÿä¸€ï¼Œä¾¿äºç»´æŠ¤å’Œæ‰©å±•ï¼Œä¸ºç³»ç»Ÿçš„é•¿æœŸå‘å±•å¥ å®šäº†è‰¯å¥½çš„åŸºç¡€ã€‚ 