# 数据库设置指南

## 问题分析

根据错误日志，系统遇到了两个主要问题：

1. **数据库不存在**: `FATAL: 数据库 "course_manager" 不存在`
2. **Hibernate方言错误**: `Unable to load class [org.hibernate.dialect.PostgreSQLDialect ]`

## 解决方案

### 1. 创建数据库

由于使用的是人大金仓数据库（KingbaseES），需要手动创建数据库：

#### 方法1：使用数据库管理工具
1. 打开人大金仓数据库管理工具
2. 连接到数据库服务器（localhost:54321）
3. 使用SYSTEM用户登录
4. 创建名为`course_manager`的数据库

#### 方法2：使用SQL命令
```sql
-- 连接到默认数据库
-- 创建course_manager数据库
CREATE DATABASE course_manager;
```

### 2. 导入数据库结构

创建数据库后，需要导入表结构：

1. 使用数据库管理工具连接到`course_manager`数据库
2. 执行`complete_unified_database.sql`脚本
3. 或者执行`system_database_schema.sql`脚本（仅系统模块）

### 3. 配置修复

已经修复了以下配置：

#### system模块JPA配置
在`system/src/main/resources/application-system.yml`中添加了：
```yaml
jpa:
  hibernate:
    ddl-auto: update
  show-sql: true
  properties:
    hibernate:
      dialect: org.hibernate.dialect.PostgreSQLDialect
      format_sql: true
```

#### 添加JPA依赖
在`system/pom.xml`中添加了：
```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-data-jpa</artifactId>
    <version>2.7.18</version>
</dependency>
```

## 启动步骤

1. **创建数据库**: 使用上述方法创建`course_manager`数据库
2. **导入表结构**: 执行数据库初始化脚本
3. **重新编译**: 运行`mvn clean compile`重新编译项目
4. **启动应用**: 运行system模块

## 注意事项

- 确保人大金仓数据库服务正在运行
- 确保数据库连接参数正确（host: localhost, port: 54321）
- 确保用户权限足够创建数据库和表
- 如果仍有方言问题，可能需要添加PostgreSQL方言依赖

## 可选：添加PostgreSQL方言依赖

如果仍有方言问题，可以在system模块的pom.xml中添加：
```xml
<dependency>
    <groupId>org.hibernate</groupId>
    <artifactId>hibernate-core</artifactId>
    <version>5.6.15.Final</version>
</dependency>
``` 